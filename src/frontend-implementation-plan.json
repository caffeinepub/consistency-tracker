{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix startup crash by gating dashboard render until user profile query resolves",
  "requirements": [
    {
      "id": "REQ-4",
      "summary": "Gate authenticated flow so TrackerDashboard never renders until the caller profile query has deterministically resolved to UserProfile or null.",
      "acceptanceCriteria": [
        "On an authenticated session, the app does not render `TrackerDashboard` until `useGetCallerUserProfile()` has resolved to either `UserProfile` or `null` (never `undefined`).",
        "The fatal error screen shown in the screenshot (\"undefined is not an object (evaluating 'userProfile.name')\") no longer appears on initial page load.",
        "If the caller has no profile, the app shows the Profile Setup screen instead of crashing.",
        "If the caller has a profile, the app shows the dashboard and the header renders the welcome message without errors."
      ],
      "file_operations": [
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Update the authenticated render gating to treat the profile as 'unresolved' until the profile query is fetched, showing the existing loading UI during that period and only rendering ProfileSetup when fetched and the result is explicitly null, and only rendering TrackerDashboard when fetched and a real profile object exists (never passing an undefined profile)."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Harden `useGetCallerUserProfile()` to expose a deterministic 'resolved' signal for the caller profile query (e.g., via `isFetched`/`isLoading` semantics already present) so consuming components can reliably block rendering until the actor dependency and query have completed."
        }
      ]
    },
    {
      "id": "REQ-5",
      "summary": "Make header/user badge rendering resilient to missing or empty profile name with safe fallbacks so the app remains usable.",
      "acceptanceCriteria": [
        "No part of the header crashes when `userProfile.name` is empty or missing; the UI renders with a safe fallback instead.",
        "The app remains usable (no ErrorBoundary fatal fallback) even if the profile data is malformed, and the user can still log out."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/Header.tsx",
          "operation": "modify",
          "description": "Add defensive rendering for the welcome message and avatar initial so they never call string methods on missing/empty `name` (e.g., conditionally render the welcome name only when non-empty, and render a safe fallback initial when absent), while keeping the logout menu accessible."
        }
      ]
    }
  ]
}