{
  "kind": "spec_vs_diff_report",
  "version": "1.0",
  "generatedAt": "2026-02-03T21:49:06.934Z",
  "summary": "Diff implements the new HabitUnit type and optional per-day amount fields across parts of the backend types and multiple frontend surfaces (habit creation, grid amount entry, volume stats, CSV export), and adds an explicit Motoko migration module that defaults old habits to unit=#reps and old records to amount=null. However, key backend API behavior changes (monthly records + export endpoints returning new fields, and record update/toggle logic persisting/clearing amount) are not visible in the provided backend diff excerpt, so full compliance with the backend-facing requirements cannot be confirmed from the evidence shown.",
  "missing_requirements": [
    {
      "id": "REQ-10",
      "requirement": "Update backend APIs used by the monthly tracker and reporting/export so returned monthly records and export payloads include optional numeric amount and habit unit, while preserving backward compatibility.",
      "reason": "While backend types now include unit on Habit and amount on HabitRecord, the diff excerpt does not show updates to the actual query/method implementations for getMonthlyRecords and export APIs to include/persist these fields and remain backward compatible. The relevant method bodies are truncated/not shown.",
      "evidence": [
        "backend/main.mo (truncated; only type additions + createHabit signature visible)",
        "frontend/src/hooks/useQueries.ts (truncated; calls getMonthlyRecords and export mutations but backend implementation not shown)"
      ]
    },
    {
      "id": "REQ-9",
      "requirement": "Each habit/day record supports done/not-done plus an optional numeric amount for that day; if no amount is provided, behavior matches toggle-only tracking.",
      "reason": "Backend data model types include amount, but the diff excerpt does not show the backend record-write/update logic (toggle completion endpoint) that would actually store amount (or default it) and preserve existing toggle-only behavior when amount is not provided.",
      "evidence": [
        "backend/main.mo (truncated; HabitRecord has amount but record mutation logic not shown)",
        "frontend/src/hooks/useQueries.ts (truncated; useToggleHabitCompletion mutation signature begins but not fully visible)"
      ]
    },
    {
      "id": "REQ-15",
      "requirement": "Update CSV/PDF export outputs to include optional numeric amounts and units.",
      "reason": "CSV export clearly includes Amount and Unit columns, but the diff summary references a PDF generator with volume-aware content without providing its file diff content, so inclusion of amount/unit in PDF output cannot be verified from the provided evidence.",
      "evidence": [
        "frontend/src/utils/reportCsv.ts",
        "frontend-file-summaries.txt (mentions frontend/src/utils/reportPdf.ts but no diff content shown)"
      ]
    }
  ],
  "hallucinated_features": [
    {
      "description": "Client-side PDF generation via newly added jsPDF and jspdf-autotable dependencies and a new PDF report utility.",
      "reason": "REQ-15 requests updating CSV/PDF exports, but the diff summary indicates adding PDF generation libraries and a full PDF generation implementation. If the app previously did not implement PDF export, this is an additional feature beyond 'update outputs' (though still adjacent to export requirements).",
      "evidence": [
        "frontend-file-summaries.txt (mentions frontend/src/utils/reportPdf.ts and new dependencies in frontend/package.json)"
      ]
    },
    {
      "description": "Support for a custom unit variant (#custom / custom text) beyond the minimum required reps and time/duration.",
      "reason": "REQ-9 only requires at minimum reps and time/duration; adding a custom unit option is extra scope.",
      "evidence": [
        "backend/main.mo (HabitUnit includes #custom : Text)",
        "backend/migration.mo (NewHabit.unit includes #custom : Text)",
        "frontend/src/utils/habitUnit.ts (handles '__kind__' === 'custom')"
      ]
    }
  ],
  "confidence": 0.58,
  "changed_files": [
    "backend/main.mo",
    "backend/migration.mo",
    "frontend-file-summaries.txt",
    "frontend/src/components/HabitGrid.tsx",
    "frontend/src/components/HabitManager.tsx",
    "frontend/src/components/ProgressCharts.tsx",
    "frontend/src/components/ReportExportDialog.tsx",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/utils/habitUnit.ts",
    "frontend/src/utils/reportCsv.ts",
    "frontend/src/utils/reportStats.ts",
    "project_state.json"
  ]
}